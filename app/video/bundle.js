"use strict";var tooglesApp=angular.module("tooglesApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(e){e.when("/browse",{templateUrl:"views/list.html",controller:"ListCtrl"}),e.when("/browse/:category",{templateUrl:"views/list.html",controller:"ListCtrl"}),e.when("/search/:query",{templateUrl:"views/list.html",controller:"ListCtrl"}),e.when("/view/:id",{templateUrl:"views/view.html",controller:"ViewCtrl"}),e.when("/view/:id/:starttime",{templateUrl:"views/view.html",controller:"ViewCtrl"}),e.when("/view/:id/:starttime/:endtime",{templateUrl:"views/view.html",controller:"ViewCtrl"}),e.when("/playlist/:id",{templateUrl:"views/view.html",controller:"ViewCtrl"}),e.when("/playlist/:id/:start",{templateUrl:"views/view.html",controller:"ViewCtrl"}),e.when("/user/:username",{templateUrl:"views/list.html",controller:"ListCtrl"}),e.when("/user/:username/:feed",{templateUrl:"views/list.html",controller:"ListCtrl"}),e.otherwise({redirectTo:"/browse"})}]);tooglesApp.controller("ListCtrl",["$scope","$routeParams","$location","youtube",function(e,t,i,o){e.location=i,e.routeParams=t,e.searchsort=i.search().searchsort||!1,e.searchduration=i.search().searchduration||!1,e.searchdefinition=i.search().searchdefinition||!1,e.searchdimension=i.search().searchdimension||!1,e.eventtype=i.search().eventtype||"completed",e.type=i.search().type||"video",e.searchtype=i.search().searchtype||"videos",e.section=i.path().split("/")[1],e.page=1,e.nextPageToken="",e.usedTokens=[],e.videos=[],e.categoryVideos=function(){document.title="Popular | video",o.categoryVideos(e.nextPageToken,t.category,(function(t){e.nextPageToken=t.nextPageToken,e.videos=e.videos.concat(t.items)}))},e.searchVideos=function(){document.title=t.query+" | video",e.query=t.query;var i={};t.searchsort&&(i.order=t.searchsort),t.searchduration&&(i.videoDuration=t.searchduration),t.eventtype&&(i.eventType=t.eventtype),t.searchdimension&&(i.videoDimension=t.searchdimension),t.type&&(i.Type=t.type),t.searchdefinition&&(i.videoDefinition=t.searchdefinition),o.searchVideos(e.nextPageToken,t.query,i,(function(t){e.nextPageToken=t.nextPageToken;var i=[];angular.forEach(t.items,(function(e){i.push(e.id.videoId)})),o.fetchVideos(i,(function(t){e.videos=e.videos.concat(t.items)}))}))},e.userVideos=function(){o.userData(t.username,(function(t){e.user=t.items[0],document.title=e.user.snippet.title+" | video";var i=t.items[0].contentDetails.relatedPlaylists.uploads;o.playlistVideos(e.nextPageToken,i,(function(t){e.nextPageToken=t.nextPageToken;var i=[];angular.forEach(t.items,(function(e){i.push(e.contentDetails.videoId)})),o.fetchVideos(i,(function(t){e.videos=e.videos.concat(t.items)}))}))}))},e.popularVideos=function(){document.title="Popular | video",o.popularVideos(e.nextPageToken,(function(t){e.nextPageToken=t.nextPageToken,e.videos=e.videos.concat(t.items)}))},e.loadVideos=function(){void 0===e.nextPageToken||$.inArray(e.nextPageToken,e.usedTokens)>=0&&""!==e.nextPageToken||(e.usedTokens.push(e.nextPageToken),void 0!==t.category?e.categoryVideos():void 0!==t.query&&""!==t.query&&"0"!==t.query?e.searchVideos():void 0!==t.username?e.userVideos():e.popularVideos())},e.loadVideos(),o.videoCategories((function(t){e.categories=t.items})),e.getLink=function(e){return"#/view/"+e.id},e.formatDuration=function(e){return o.formatDuration(e)},e.averageRating=function(e,t){return o.averageRating(e,t)}}]);let player="";function receiveMessage(e){if("goto"===e.data.event_id){const t=e.data.data[0];player.seekTo(t)}}window.addEventListener("message",receiveMessage,!1),tooglesApp.controller("ViewCtrl",["$scope","$routeParams","$location","youtube",function(e,t,i,o){e.location=i,e.showSidebar=!0,e.showRelated=!1,e.section=i.path().split("/")[1],e.videoTab="view"===e.section?"Related":"Playlist",e.videos=[],o.fetchVideos(t.id,(function(t){e.video=t.items[0],s(e.video.id,e.section),document.title=e.video.snippet.title+" | Toogles"})),e.fetchRelated=function(){e.showRelated=!0,o.relatedVideos(t.id,(function(t){var i=[];angular.forEach(t.items,(function(e){i.push(e.id.videoId)})),o.fetchVideos(i,(function(t){e.videos=t.items}))}))},e.formatDuration=function(e){return o.formatDuration(e)};var n=!1;if(e.$parent.darkmode)var r="dark",a="black";else r="light",a="white";var s=function(o,s){var l=t.starttime||0,d=t.endtime||"";void 0===typeof l||void 0===l||0===l||l.includes(":")&&(l=l.split(":").reduce(((e,t)=>60*e+ +t))),void 0===typeof d||void 0===d||0===d||d.includes(":")&&(d=d.split(":").reduce(((e,t)=>60*e+ +t))),player=new YT.Player("player",{videoId:o,playerVars:{autoplay:1,theme:r,color:a,iv_load_policy:3,origin:"https://conze.pt",start:l,end:d},events:{onError:function(t){101==t.data||150==t.data?e.video.restricted=1:e.video.deleted=1,e.$apply()},onStateChange:function(e){if(0===e.data&&(goWander=getParameterByName("wander")||!1,goWander?parent.postMessage({event_id:"next-wander-video",data:{}},"*"):parent.postMessage({event_id:"next-presentation-slide",data:{}},"*")),1==e.data&&(n=!0),n&&-1==e.data)if("view"===s){var t=e.target.getVideoUrl().replace("http://","").replace("https://","").replace("www.youtube.com/watch?v=","").replace("&feature=player_embedded","");window.location="#/view/"+t}else"playlist"===s&&(window.location="#/playlist/"+e.target.getPlaylistId()+"/"+e.target.getPlaylistIndex());else if(n&&0==e.data&&"playlist"===s){var o=i.path().split("/"),r=o[2];if(o[3])var a=o[3];else a=0;a++,window.location="#/playlist/"+r+"/"+a}}}})};e.getLink=function(e){return"#/view/"+e.id},e.averageRating=function(e,t){return o.averageRating(e,t)}}]),tooglesApp.service("youtube",["$http",function(e){var t=CONZEPT_WEB_BASE+"/app/proxy/video/",i="";this.searchVideos=function(e,o,n,r){var a=t+"search?part=id&type=video&maxResults="+"12&q="+o+"&xkey="+i;return n&&(a+="&"+$.param(n)),e&&(a+="&pageToken="+e),this.sendRequest(a,r)},this.relatedVideos=function(e,o){var n=t+"search?part=id&type=video&maxResults="+"12&relatedToVideoId="+e+"&xkey="+i;return this.sendRequest(n,o)},this.popularVideos=function(e,o){var n=t+"videos?part=statistics,snippet,contentDetails&chart=mostPopular&maxResults="+"12&xkey="+i;return e&&(n+="&pageToken="+e),this.sendRequest(n,o)},this.fetchVideos=function(e,o){$.isArray(e)&&(e=e.join(","));var n=t+"videos?part=statistics,snippet,contentDetails&id="+e+"&xkey="+i;return this.sendRequest(n,o)},this.categoryVideos=function(e,o,n){var r=t+"videos?part=statistics,snippet,contentDetails&chart=mostPopular&maxResults="+"12&videoCategoryId="+o+"&xkey="+i;return e&&(r+="&pageToken="+e),this.sendRequest(r,n)},this.videoCategories=function(e){var o=t+"videoCategories?part=snippet&regionCode=US&xkey="+i;return this.sendRequest(o,e)},this.playlistVideos=function(e,o,n){var r=t+"playlistItems?part=contentDetails&order=date&maxResults="+"12&playlistId="+o+"&xkey="+i;return e&&(r+="&pageToken="+e),this.sendRequest(r,n)},this.userData=function(e,o){var n=t+"channels?part=contentDetails,snippet,statistics&order=date&maxResults="+"12&id="+e+"&xkey="+i;return this.sendRequest(n,o)},this.sendRequest=function(t,i){return e.get(t).success((function(e,t,o,n){i(e)})).error((function(e,t,i,o){}))},this.formatDuration=function(e){var t=/^PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?$/,i=0,o=0,n=0;if(t.test(e)){var r=t.exec(e);r[1]&&(i=Number(r[1])),r[2]&&(o=Number(r[2])),r[3]&&(n=Number(r[3]));var a=3600*i+60*o+n,s=(i=parseInt(a/3600)%24,o=parseInt(a/60)%60,"");return i>0&&(s+=i+":"),s+=i>0?(o<10?"0"+o:o)+":":o+":",s+=(n=a%60)<10?"0"+n:n}},this.averageRating=function(e,t){return 100*((e=parseInt(e))/(e+(t=parseInt(t))))}}]),tooglesApp.filter("htmlify",(function(){return function(e){if(!e)return"";var t=e.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,"<a href='$1'>$1</a>");return t=t.replace(/\n/g,"<br />")}})),tooglesApp.directive("whenScrolled",(function(){return function(e,t,i){$(window).scroll((function(){$(window).scrollTop()>=$(document).height()-$(window).height()-10&&e.$apply(i.whenScrolled)}))}}));
