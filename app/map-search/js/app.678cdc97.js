(function(t){function e(e){for(var a,o,s=e[0],c=e[1],u=e[2],p=0,d=[];p<s.length;p++)o=s[p],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&d.push(r[o][0]),r[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);l&&l(e);while(d.length)d.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(a=!1)}a&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},r={app:0},i=[];function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/app/map-search/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var l=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";n("64a9")},1:function(t,e){},"25d4":function(t,e,n){},"3c4b":function(t,e,n){},4086:function(t,e,n){"use strict";n("25d4")},"47ee":function(t,e,n){"use strict";n("e075")},"56d7":function(t,e,n){"use strict";n.r(e),n.d(e,"store",(function(){return F}));n("7f7f");var a=n("2b0e"),r=n("9437"),i=n.n(r),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("sidebar",{attrs:{featuredMap:t.map}}),n("leaflet")],1)},s=[],c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sidebar"},[n("link",{attrs:{href:"https://fonts.googleapis.com/css?family=Quicksand&display=swap",rel:"stylesheet"}}),n("h1",[t._v("historic maps")]),t.username?t._e():n("button",{staticClass:"mw-ui-button mw-ui-constructive sign-in",on:{click:t.signIn}},[t._v("sign in")]),t.username?n("button",{staticClass:"mw-ui-button mw-ui-constructive sign-in",attrs:{title:"Signed in as "+t.username},on:{click:t.signOut}},[t._v("sign out")]):t._e(),n("form",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],staticClass:"mw-ui-input",attrs:{id:"search-input",type:"text",placeholder:"Search by title"},domProps:{value:t.searchText},on:{input:function(e){e.target.composing||(t.searchText=e.target.value)}}}),n("button",{ref:"submitBtn",staticClass:"mw-ui-button mw-ui-constructive mw-ui-block margin-top-5",on:{click:function(e){t.search(t.searchText,e)}}},[n("b",[t._v("search")])])]),t.searchResult.length>0||"done"===t.searchStatus?n("h2",[t._v(t._s(t.searchResult.length)+" results")]):t._e(),"executing"===t.searchStatus?n("spinner",{staticClass:"margin-top-14",attrs:{"line-fg-color":"#00af89"}}):t._e(),"done"===t.searchStatus&&0===t.searchResult.length?n("p",[t._v("No results found.")]):t._e(),t.searchResult.length>0?n("ul",{staticClass:"result-list"},t._l(t.searchResult,(function(t){return n("mapitem",{key:t.id,attrs:{map:t}})}))):t._e()],1)},u=[],l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.map?n("li",[n("div",{staticClass:"main",attrs:{tabindex:"0"},on:{click:t.clicked,keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.clicked()}}},[n("img",{attrs:{src:t.map.attributes.thumb_url}}),n("div",[n("h3",[t._v(t._s(t.refineTitle(t.map.attributes.title)))])])]),t.active?n("div",{staticClass:"extended"},[n("button",{staticClass:"mw-ui-button mw-ui-progressive mw-ui-block margin-top-5",on:{click:t.toggleFullscreen}},[t._v("View Map")]),n("h4",[t._v("Open in:")]),n("a",{attrs:{href:"https://commons.wikimedia.org/wiki/File:"+t.map.attributes.unique_id}},[t._v("Wikimedia Commons")]),n("a",{attrs:{href:"https://warper.wmflabs.org/maps/"+t.map.id}},[t._v("Wikimaps Warper")]),n("h4",[t._v("Export as:")]),n("a",{attrs:{href:t.map.links.geotiff,download:""}},[t._v("GeoTiff")]),n("a",{attrs:{href:t.map.links.png,download:""}},[t._v("PNG")]),n("a",{attrs:{href:t.map.links.kml,download:""}},[t._v("KML")]),n("p",[t._v("Copyright holder and licensing information can be found on Wikimedia Commons.")])]):t._e()]):t._e()},p=[],d=(n("a481"),new a["a"]),f={name:"mapitem",props:{map:!1,activeInit:!1},data:function(){return{active:this.activeInit}},methods:{refineTitle:function(t){return t.slice(5).replace(/\.[^/.]+$/,"").replace(/_/g," ")},clicked:function(){this.active?(this.active=!1,this.toggleURLHash(""),d.$emit("clearLayers")):(this.active=!0,d.$emit("selected",this.map))},toggleFullscreen:function(){d.$emit("toggleFullscreen")},toggleURLHash:function(t){window.location.hash="#"+t}},mounted:function(){var t=this;this.active&&(d.$emit("selected",this.map),this.toggleURLHash(this.map.id)),d.$on("selected",(function(e){e.id!==t.map.id&&(t.active=!1),t.toggleURLHash(e.id)}))}},m=f,h=(n("47ee"),n("2877")),g=Object(h["a"])(m,l,p,!1,null,"5c25a633",null),v=g.exports,b=n("5b7e"),w=n.n(b),_={name:"sidebar",components:{mapitem:v,Spinner:w.a},props:{featuredMap:!1},data:function(){var t=window.location.href,e=new URL(t),n=e.searchParams.get("q")||"";return{searchResult:[],searchText:n,bbox:!1,searchStatus:"not-executed"}},mounted:function(){this.$refs.submitBtn.click()},computed:{username:function(){return F.state.username}},methods:{search:function(t,e){var n=this;e&&e.preventDefault(),this.searchStatus="executing";var a="";d.$emit("getBounds",(function(t){a="&bbox=".concat(t.getWest(),",").concat(t.getSouth(),",").concat(t.getEast(),",").concat(t.getNorth())}));var r="maps.json?query=".concat(t,"&show_warped=1&per_page=20");this.bbox&&(r+=a),this.searchResult=[],this.$http.get(r).then((function(t){n.searchResult=t.body.data,n.searchStatus="done"}))},signIn:function(){var t="https://warper.wmflabs.org",e=window.open(t+"/u/auth/mediawiki?omniauth_window_type=newWindow&auth_origin_url="+window.location.href,"myWindow"),n=setInterval((function(){var n="requestCredentials";e.postMessage(n,t)}),500);window.addEventListener("message",(function(e){e.origin===t&&(clearInterval(n),F.commit("signIn",e.data))}),!1)},signOut:function(){F.commit("signOut")}}},y=_,k=(n("6ca6"),Object(h["a"])(y,c,u,!1,null,"042ce10d",null)),x=k.exports,C=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"leaflet"}})},O=[],$=(n("28a5"),n("e11e")),S=n.n($),T=(n("6005"),n("0de5"),n("6698"),n("6cc5"),n("b048"),n("1d84"),n("44c8"),n("1f54"),{name:"leaflet",mounted:function(){var t=S.a.map("leaflet",{attributionControl:!1,fullscreenControl:!0,center:[40,10],zoom:3}),e=S.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Background &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'});e.addTo(t);var n=S.a.layerGroup().addTo(t);S.a.control.attribution({prefix:""}).addTo(t),t.zoomControl.setPosition("topright"),t.fullscreenControl.setPosition("topright"),S.a.control.locate({position:"topright"}).addTo(t);var a={"":e};d.$on("selected",(function(e){n.clearLayers();var r=new S.a.tileLayer.wms(e.links.wms,{layers:"MapWarper",format:"image/png",attribution:'<a href="https://commons.wikimedia.org/wiki/'.concat(e.attributes.title,'">Wikimedia Commons</a>')});n.addLayer(r);var i={"":r};document.querySelectorAll(".leaflet-control-layers").forEach((function(t){t.remove()})),S.a.control.layers(a,i,{collapsed:!1}).addTo(t),S.a.control.opacity(i,{label:"opacity"}).addTo(t);var o=e.attributes.bbox.split(",");t.fitBounds([[o[3],o[2]],[o[1],o[0]]])})),d.$on("clearLayers",(function(){n.clearLayers()})),d.$on("getBounds",(function(e){e(t.getBounds())})),d.$on("toggleFullscreen",(function(){t.toggleFullscreen()}))}}),M=T,j=(n("4086"),Object(h["a"])(M,C,O,!1,null,"f8ee3784",null)),L=j.exports,R={name:"app",components:{sidebar:x,leaflet:L},asyncComputed:{map:{get:function(){var t=window.location.hash.substring(1);return t?this.$http.get("maps/"+t).then((function(t){return t.body.data})):this.featuredMap}},featuredMap:{get:function(){var t=["86"];return this.$http.get("maps/"+t[Math.floor(Math.random()*t.length)]).then((function(t){return t.body.data}))},default:!1}}},P=R,E=(n("034f"),Object(h["a"])(P,o,s,!1,null,null,null)),W=E.exports,I=n("28dd"),B=n("2f62");a["a"].use(i.a),a["a"].use(I["a"]),a["a"].use(B["a"]),a["a"].config.productionTip=!1,a["a"].http.options.root="https://warper.wmflabs.org/api/v1";var F=new B["a"].Store({state:{username:null,token:null},mutations:{signIn:function(t,e){t.token=e.auth_token,t.username=e.name},signOut:function(t){t.token=null,t.username=null}}});new a["a"]({render:function(t){return t(W)}}).$mount("#app")},"64a9":function(t,e,n){},"6ca6":function(t,e,n){"use strict";n("3c4b")},e075:function(t,e,n){}});
//# sourceMappingURL=app.678cdc97.js.map